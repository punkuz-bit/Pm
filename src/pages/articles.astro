---
import Base from "../layouts/Base.astro";

type Post = {
  url: string;
  frontmatter: {
    title: string;
    description?: string;
    date?: string;
    tags?: string[];
    linkedin?: string;
    thumb?: string;
  };
};

const modules = import.meta.glob('../../content/articles/*.mdx', { eager: true }) as Record<string, Post>;

const posts = Object.entries(modules)
  .map(([path, mod]) => {
    const slug = path.split('/').pop()?.replace('.mdx','') || '';
    const fm = mod.frontmatter ?? {};
    return {
      slug,
      title: fm.title,
      description: fm.description ?? '',
      date: fm.date ?? '',
      tags: fm.tags ?? [],
      linkedin: (fm as any).linkedin ?? '',
      thumb: (fm as any).thumb ?? ''
    };
  })
  .sort((a,b) => (b.date ?? '').localeCompare(a.date ?? ''));
---

<Base>
 <style>
  .card {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 14px;
    backdrop-filter: blur(6px);
    overflow: hidden;
    transition: transform .2s ease, box-shadow .2s ease;
  }
  .card:hover { transform: translateY(-3px); box-shadow: 0 6px 16px rgba(201,162,39,.2); }

  /* Ensures full coverage behind every image */
  .thumb-wrap {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 180px;
    padding: 8px;
    background: #0b0d16; /* obsidian */
    border-bottom: 1px solid rgba(255,255,255,.1);
  }

  .thumb-frame {
    width: 100%; height: 100%;
    display:flex; align-items:center; justify-content:center;
    border: 1px solid rgba(201,162,39,.25);
    box-shadow: 0 0 8px rgba(201,162,39,.15);
    border-radius: 12px;
    background:#0b0d16; /* ensure no gaps if image has transparency */
    transition: box-shadow .3s ease, transform .3s ease;
  }

  .thumb {
    display:block;
    max-width:100%;
    max-height:100%;
    object-fit: contain;      /* no cropping */
    background:#0b0d16;       /* behind transparent PNGs */
    border-radius: 10px;
  }

  a.thumb-link:hover .thumb-frame {
    box-shadow: 0 0 14px rgba(201,162,39,.4);
    transform: scale(1.02);
  }

  .article-title { display:inline-block; color:#fff; text-decoration:none; transition: color .25s ease, text-shadow .25s ease; }
  .article-title:hover { color:#C9A227; text-shadow:0 0 6px rgba(201,162,39,.4); }

  /* Body text on dark */
  .meta { color:#e5e7eb; }

  @media (min-width: 640px) { .thumb-wrap { height: 160px; } }
</style>


  <div class="max-w-5xl mx-auto px-4 py-10">
    <h2 class="text-3xl font-bold mb-2 text-white">Professional Articles</h2>
    <p class="text-gray-400 mb-6">Published on LinkedIn with on-site previews.</p>

    <div class="grid sm:grid-cols-2 gap-6">
      {posts.map(p => {
        const link = p.linkedin || `/articles/${p.slug}`;
        return (
          <article class="card overflow-hidden" key={p.slug}>
            <!-- Clickable contained thumbnail -->
            <div class="thumb-wrap">
              <a class="thumb-link" href={link} target={p.linkedin ? "_blank" : "_self"} rel="noopener">
                <div class="thumb-frame">
                  {p.thumb ? (
                    <img class="thumb" src={p.thumb} alt={p.title} />
                  ) : (
                    <div class="thumb" style="background:linear-gradient(180deg,#0b0d16,#111315);position:relative;">
                      <span style="position:absolute;left:12px;bottom:10px;color:#C9A227;font-weight:800;">
                        Pankaj Misra
                      </span>
                    </div>
                  )}
                </div>
              </a>
            </div>

            <!-- Text content -->
            <div class="p-4">
              <h3 class="text-lg font-semibold">
                <a href={link} target={p.linkedin ? "_blank" : "_self"} rel="noopener" class="article-title">
                  {p.title}
                </a>
              </h3>
              <div class="text-xs text-gray-400 mt-1">{p.date}</div>
              <p class="text-gray-300 mt-2">{p.description}</p>

              <div class="mt-3 flex gap-3 flex-wrap">
                <a class="text-indigo underline" href={`/articles/${p.slug}`}>Open preview →</a>
                {p.linkedin && (
                  <a class="text-indigo underline" href={p.linkedin} target="_blank" rel="noopener">
                    Read on LinkedIn →
                  </a>
                )}
              </div>
            </div>
          </article>
        );
      })}
    </div>
  </div>
</Base>

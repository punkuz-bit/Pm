---
import Base from "../layouts/Base.astro";

// Serve from /public
const hero = "/hero.png";

// Load books & pick Echoes as featured
type BookMod = {
  frontmatter: {
    title: string;
    description?: string;
    cover?: string;
    date?: string;
    tags?: string[];
    buy?: string;
  };
};
const modules = import.meta.glob('../../content/books/*.mdx', { eager: true }) as Record<string, BookMod>;
const books = Object.entries(modules).map(([p, m]) => {
  const slug = p.split('/').pop()?.replace('.mdx','') || '';
  return { slug, ...(m.frontmatter || {}) };
});
const featured =
  books.find(b => b.slug === 'echoes-of-caldera') ??
  books[0] ?? { title:'Coming soon', description:'', cover:'', buy:'' };
---

<Base>
  <style>
    /* Gold button + badge */
    .btn-gold{display:inline-block;padding:.5rem 1rem;border-radius:.75rem;font-weight:700;border:1px solid #C9A227;background:#C9A227;color:#0b0d16}
    .btn-gold:hover{opacity:.9}
    .badge-gold{display:inline-flex;align-items:center;padding:.25rem .6rem;border-radius:999px;border:1px solid #C9A227;background:#C9A227;color:#0b0d16;font-size:.8rem}

    /* Clamp text if needed */
    .clamp-3{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
  </style>

  <!-- Obsidian full-page section -->
  <section
    class="text-white min-h-[90vh]"
    style="background:
      radial-gradient(900px 360px at 70% -10%, rgba(201,162,39,.12), transparent 60%),
      linear-gradient(180deg, #0b0d16 0%, #111315 100%);"
  >
    <div class="max-w-6xl mx-auto px-4 pt-6 md:pt-10 pb-12">

      <!-- HERO fills viewport height -->
      <div class="overflow-hidden rounded-xl border border-white/10">
        <img src={hero} alt="Pankaj Misra â€” Author & Strategist"
             class="w-full h-[70vh] md:h-[82vh] object-cover" />
      </div>

      <!-- Headline + copy BELOW the hero image -->
      <div class="mt-6 md:mt-8">
        <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">
          Bridging <span class="text-indigo">Human Potential</span> and <span style="color:#C9A227">storytelling</span>.
        </h1>
        <p class="text-gray-300 mt-3 max-w-3xl">
          Fiction that crackles with geoscience and myth. Professional writing on Banking, Insurance, data, and AI transformation.
        </p>
        <div class="mt-4 flex gap-3 flex-wrap">
          <a class="btn-gold" href="/books">Explore Books</a>
          <a class="btn-gold" href="/articles">Read Articles</a>
        </div>
      </div>

      <!-- FEATURED BOOK -->
      <div class="mt-10 md:mt-12">
        <h2 class="text-2xl md:text-3xl font-bold mb-3">Latest Book</h2>

        <article class="grid md:grid-cols-[200px_1fr] gap-5 items-start rounded-xl border border-white/15 bg-white/8 backdrop-blur p-5">
          <!-- No cropping: use object-contain + padded box -->
          <div class="w-full rounded-lg border border-white/15 bg-black/40 p-2 flex items-center justify-center">
            {featured.cover
              ? <img src={featured.cover} alt={featured.title}
                     class="max-h-[280px] w-auto object-contain" />
              : <div class="w-full h-[260px] bg-black/30 rounded" />
            }
          </div>

          <div class="text-white">
            <h3 class="text-xl font-semibold">{featured.title}</h3>
            {featured.date && <div class="text-sm text-gray-300 mt-1">{featured.date}</div>}
            {featured.description && <p class="text-gray-200 mt-2 clamp-3">{featured.description}</p>}

            <div class="mt-3 flex gap-2 flex-wrap">
              <a class="btn-gold" href={`/books/${featured.slug}`}>Details</a>
              {featured.buy
                ? <a class="btn-gold" href={featured.buy} target="_blank" rel="noopener">Buy on Amazon</a>
                : <span class="badge-gold">Coming soon</span>
              }
            </div>

            <div class="text-sm text-gray-300 mt-3">
              Published by <a class="underline" href="https://himantrix.com" target="_blank" rel="noopener">HiMantrix</a>
            </div>
          </div>
        </article>
      </div>

    </div>
  </section>
</Base>

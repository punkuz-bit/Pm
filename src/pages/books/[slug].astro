---
import Base from "../../layouts/Base.astro";

export async function getStaticPaths() {
  const modules = import.meta.glob('../../../content/books/*.mdx');
  // Build static paths: /books/<slug>
  return Object.keys(modules).map((filepath) => {
    const slug = filepath.split('/').pop()?.replace('.mdx','') || '';
    return { params: { slug } };
  });
}

// Load the MDX that matches this slug
const modules = import.meta.glob('../../../content/books/*.mdx');
const entry = Object.entries(modules).find(([path]) => path.endsWith(`${Astro.params.slug}.mdx`));

if (!entry) {
  throw new Error(`Book not found for slug: ${Astro.params.slug}`);
}

const mod: any = await entry[1]();
const { Content, frontmatter } = mod;
const { title, description, cover, date, tags = [] } = frontmatter || {};
---

<Base title={title} description={description}>
  <div class="max-w-3xl mx-auto px-4 py-10">
    <p><a href="/books" class="text-indigo underline">‚Üê Back to Books</a></p>

    <div class="mt-3">
      <h1 class="text-3xl font-bold">{title}</h1>
      {date && <div class="text-sm text-gray-500 mt-1">{date}</div>}
    </div>

    {cover && (
      <div class="mt-5">
        <img src={cover} alt={title} class="w-full max-h-[420px] object-cover rounded-xl border" />
      </div>
    )}

    <div class="prose max-w-none mt-6">
      <Content />
    </div>
  </div>
</Base>

---
import Base from "../layouts/Base.astro";

// 1) HERO image (served from /public)
const hero = '/hero.png';

// 2) Load books and pick Echoes of Caldera for Featured section
type BookMod = {
  frontmatter: {
    title: string;
    description?: string;
    cover?: string;
    date?: string;
    tags?: string[];
    buy?: string;
  };
  // MDX default export is the content; we don't render it on home
};

const modules = import.meta.glob('../../content/books/*.mdx', { eager: true }) as Record<string, BookMod>;
const books = Object.entries(modules).map(([path, mod]) => {
  const slug = path.split('/').pop()?.replace('.mdx', '') || '';
  const fm = mod.frontmatter || {};
  return { slug, ...fm };
});

// Prefer Echoes of Caldera; fallback to first book
const featured =
  books.find(b => b.slug === 'echoes-of-caldera') ??
  books[0] ??
  { title: 'Coming soon', description: '', cover: '', buy: '' };
---

<Base>
  <!-- Full-bleed obsidian background -->
  <section
    class="text-white"
    style="background:
      radial-gradient(800px 300px at 70% -10%, rgba(201,162,39,.12), transparent 60%),
      linear-gradient(180deg, #0b0d16 0%, #111315 100%);
      "
  >
    <div class="max-w-5xl mx-auto px-4 py-10 md:py-16">

      <!-- HERO IMAGE (top) -->
      <div class="card overflow-hidden">
        <img src={hero} alt="Hero banner" class="w-full h-[320px] md:h-[380px] object-cover" />
      </div>

      <!-- HEADLINE + COPY (below hero image) -->
      <div class="mt-6 md:mt-8">
        <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">
          Bridging <span class="text-indigo">Human Potential</span> and <span style="color:#C9A227">storytelling</span>.
        </h1>
        <p class="text-gray-300 mt-3 max-w-3xl">
          Fiction that crackles with geoscience and myth. Professional writing on Banking, Insurance, data, and AI transformation.
        </p>
        <div class="mt-4 flex gap-3 flex-wrap">
          <a class="btn btn-primary" href="/books">Explore Books</a>
          <a class="btn btn-outline" href="/articles">Read Articles</a>
        </div>
      </div>

      <!-- FEATURED BOOK: Echoes of Caldera -->
      <div class="mt-10 md:mt-12">
        <h2 class="text-2xl md:text-3xl font-bold mb-3">Latest Book</h2>
        <article class="grid md:grid-cols-[180px_1fr] gap-4 items-start card p-4 bg-white text-ink">
          {featured.cover
            ? <img src={featured.cover} alt={featured.title} class="w-full h-[240px] object-cover rounded-lg border" />
            : <div class="w-full h-[240px] bg-gray-200 rounded-lg border" />
          }
          <div>
            <h3 class="text-xl font-semibold">{featured.title}</h3>
            {featured.date && <div class="text-sm text-gray-500">{featured.date}</div>}
            {featured.description && <p class="text-gray-700 mt-2">{featured.description}</p>}
            <div class="mt-3 flex gap-2 flex-wrap">
              <a class="btn btn-outline" href={`/books/${featured.slug}`}>Details</a>
              {featured.buy
                ? <a class="btn btn-primary" href={featured.buy} target="_blank" rel="noopener">Buy on Amazon</a>
                : <span class="inline-flex items-center px-3 py-1 rounded-full border text-sm">Coming soon</span>
              }
            </div>
            <div class="text-sm text-gray-600 mt-3">
              Published by <a class="underline" href="https://himantrix.com" target="_blank" rel="noopener">HiMantrix</a>
            </div>
          </div>
        </article>
      </div>

      <!-- Add a bit of padding so the obsidian background visibly covers the whole viewport -->
      <div class="py-4"></div>
    </div>
  </section>
</Base>

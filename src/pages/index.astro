---
import Base from "../layouts/Base.astro";

const hero = "/hero.png";

/* FEATURED BOOK (Echoes if present) */
type BookMod = { frontmatter: { title: string; description?: string; cover?: string; date?: string; tags?: string[]; buy?: string; } };
const bookMods = import.meta.glob('../../content/books/*.mdx', { eager: true }) as Record<string, BookMod>;
const books = Object.entries(bookMods).map(([p, m]) => ({ slug: p.split('/').pop()?.replace('.mdx','') || '', ...(m.frontmatter || {}) }));
const featured = books.find(b => b.slug === 'echoes-of-caldera') ?? books[0] ?? { title:'Coming soon', description:'', cover:'', buy:'' };

/* LATEST ARTICLE (by date desc) */
type ArticleMod = { frontmatter: { title: string; description?: string; date?: string; tags?: string[]; linkedin?: string; } };
const artMods = import.meta.glob('../../content/articles/*.mdx', { eager: true }) as Record<string, ArticleMod>;
const articles = Object.entries(artMods)
  .map(([p, m]) => ({ slug: p.split('/').pop()?.replace('.mdx','') || '', ...(m.frontmatter || {}) }))
  .sort((a,b) => (b.date ?? '').localeCompare(a.date ?? ''));
const latestArticle = articles[0] ?? { title: 'New article coming soon', description: '', slug: '', linkedin: '' };
---

<Base>
  <style>
    .btn-gold{display:inline-block;padding:.6rem 1.1rem;border-radius:.75rem;font-weight:700;border:1px solid #C9A227;background:#C9A227;color:#0b0d16}
    .btn-gold:hover{opacity:.9}
    .badge-gold{display:inline-flex;align-items:center;padding:.25rem .6rem;border-radius:999px;border:1px solid #C9A227;background:#C9A227;color:#0b0d16;font-size:.8rem}
    .clamp-3{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
  </style>

  <!-- Full-bleed obsidian background for the whole front section -->
  <section
    class="text-white"
    style="background:
      radial-gradient(900px 360px at 70% -10%, rgba(201,162,39,.12), transparent 60%),
      linear-gradient(180deg, #0b0d16 0%, #111315 100%);"
  >
    <div class="max-w-none">
      <!-- HERO as responsive background (no side bands) -->
      <div
        class="w-full min-h-[42vh] sm:min-h-[50vh] md:min-h-[70vh] lg:min-h-[82vh]"
        style={`background-image:url(${hero}); background-size:cover; background-repeat:no-repeat; background-position:center 20%;`}
      >
        <div class="w-full h-full bg-black/10"></div>
      </div>

      <div class="max-w-6xl mx-auto px-4 pt-6 md:pt-8 pb-10">
        <!-- Centered Headline -->
        <div class="text-center">
          <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">
            Bridging <span style="color:#C9A227">Human Potential</span> and <span style="color:#C9A227">Storytelling</span>.
          </h1>
        </div>

        <!-- 2Ã—2 grid with per-column buttons (centered) -->
        <div class="grid sm:grid-cols-2 gap-6 mt-6 max-w-4xl mx-auto text-gray-300">
          <div class="p-3 flex flex-col items-center text-center">
            <p>Fiction that crackles with geoscience, history and an adventurous spirit.</p>
            <a class="btn-gold mt-4" href="/books">Explore Books</a>
          </div>
          <div class="p-3 flex flex-col items-center text-center">
            <p>Professional writing on Banking, Insurance, Data, and AI-enabled transformation.</p>
            <a class="btn-gold mt-4" href="/articles">Read Articles</a>
          </div>
        </div>

        <!-- Latest Book (centered) -->
        <div class="mt-12 md:mt-14">
          <h2 class="text-2xl md:text-3xl font-bold text-center mb-3">Latest Book</h2>
          <article class="max-w-3xl mx-auto rounded-xl border border-white/15 bg-white/8 backdrop-blur p-5 grid md:grid-cols-[200px_1fr] gap-5 items-start">
            <div class="w-full rounded-lg border border-white/15 bg-black/40 p-2 flex items-center justify-center">
              {featured.cover
                ? <img src={featured.cover} alt={featured.title} class="max-h-[280px] w-auto object-contain" />
                : <div class="w-full h-[260px] bg-black/30 rounded" />
              }
            </div>
            <div class="text-white text-center md:text-left">
              <h3 class="text-xl font-semibold">{featured.title}</h3>
              {featured.date && <div class="text-sm text-gray-300 mt-1">{featured.date}</div>}
              {featured.description && <p class="text-gray-200 mt-2 clamp-3">{featured.description}</p>}
              <div class="mt-3 flex gap-2 flex-wrap justify-center md:justify-start">
                <a class="btn-gold" href={`/books/${featured.slug}`}>Details</a>
                {featured.buy
                  ? <a class="btn-gold" href={featured.buy} target="_blank" rel="noopener">Buy on Amazon</a>
                  : <span class="badge-gold">Coming soon</span>
                }
              </div>
              <div class="text-sm text-gray-300 mt-3">
                Published by <a class="underline" href="https://himantrix.com" target="_blank" rel="noopener">HiMantrix</a>
              </div>
            </div>
          </article>
        </div>

        <!-- Latest Article (centered) -->
        <div class="mt-12 md:mt-14">
          <h2 class="text-2xl md:text-3xl font-bold text-center mb-3">Latest Article</h2>
          <article class="max-w-3xl mx-auto rounded-xl border border-white/15 bg-white/8 backdrop-blur p-5 text-white">
            <h3 class="text-xl font-semibold text-center md:text-left">{latestArticle.title}</h3>
            {latestArticle.date && <div class="text-sm text-gray-300 mt-1 text-center md:text-left">{latestArticle.date}</div>}
            {latestArticle.description && <p class="text-gray-200 mt-3 text-center md:text-left">{latestArticle.description}</p>}
            <div class="mt-4 flex gap-2 flex-wrap justify-center md:justify-start">
              {latestArticle.slug && <a class="btn-gold" href={`/articles/${latestArticle.slug}`}>Open preview</a>}
              {latestArticle.linkedin && <a class="btn-gold" href={latestArticle.linkedin} target="_blank" rel="noopener">Read on LinkedIn</a>}
            </div>
          </article>
        </div>
      </div>
    </div>
  </section>
</Base>
